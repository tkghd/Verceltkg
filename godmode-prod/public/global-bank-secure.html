<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Global Bank (Secured)</title>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: system-ui; background: linear-gradient(135deg, #1a1a2e, #0f3460); color: #fff; min-height: 100vh; }
.app { max-width: 480px; margin: 0 auto; min-height: 100vh; background: rgba(26,26,46,0.95); }
.header { padding: 20px; background: linear-gradient(135deg, rgba(0,255,136,0.1), rgba(0,212,255,0.1)); border-bottom: 1px solid rgba(0,255,136,0.2); }
.logo { font-size: 24px; font-weight: bold; background: linear-gradient(135deg, #00ff88, #00d4ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.balance { background: linear-gradient(135deg, rgba(0,255,136,0.15), rgba(0,212,255,0.15)); border-radius: 20px; padding: 24px; margin: 20px; border: 1px solid rgba(0,255,136,0.3); }
.amount { font-size: 42px; font-weight: bold; background: linear-gradient(135deg, #00ff88, #00d4ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.accounts { padding: 20px; }
.account { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 16px; margin-bottom: 12px; display: flex; justify-content: space-between; }
.tx-list { padding: 20px; }
.tx { background: rgba(255,255,255,0.02); border-radius: 12px; padding: 16px; margin-bottom: 12px; display: flex; gap: 12px; }
.positive { color: #00ff88; }
.negative { color: #ff6b6b; }
.secured-badge { background: rgba(0,255,0,0.2); border: 1px solid #00ff00; border-radius: 8px; padding: 8px 12px; font-size: 12px; display: inline-block; margin-top: 8px; }
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect } = React;

// „Éï„É≠„É≥„Éà„Ç®„É≥„Éâ„Åß„ÅØAPI„Ç≠„Éº„Çí‰Ωø„Çè„Å™„ÅÑÔºàNginx„É™„Éê„Éº„Çπ„Éó„É≠„Ç≠„Ç∑ÁµåÁî±Ôºâ
const API = 'http://' + window.location.hostname + '/api';

function App() {
  const [data, setData] = useState({ accounts: [], txs: [], rates: {} });
  const [authenticated, setAuthenticated] = useState(false);

  useEffect(() => {
    // Public endpoint (Ë™çË®º‰∏çË¶Å)
    Promise.all([
      fetch(API + '/exchange-rates'),
      // Protected endpoints (NginxÁµåÁî±„ÅßËá™ÂãïË™çË®º)
      fetch(API + '/balance/1'),
      fetch(API + '/transactions/1')
    ])
    .then(([r1, r2, r3]) => Promise.all([r1.json(), r2.json(), r3.json()]))
    .then(([rates, bal, tx]) => {
      setData({ accounts: bal.accounts, txs: tx, rates: rates.rates });
      setAuthenticated(true);
    })
    .catch(err => {
      console.error('API Error:', err);
      setAuthenticated(false);
    });
  }, []);

  const fmt = (amt, cur) => new Intl.NumberFormat('ja-JP', {style: 'currency', currency: cur}).format(amt);

  return (
    <div className="app">
      <div className="header">
        <div className="logo">üåç Global Bank</div>
        <div className="secured-badge">üîí Secured API</div>
      </div>
      <div className="balance">
        <div style={{fontSize: '14px', opacity: 0.8}}>Total Assets</div>
        <div className="amount">{fmt(data.accounts.reduce((s, a) => s + a.balance, 0), 'JPY')}</div>
        <div style={{fontSize: '12px', color: '#00ff88', marginTop: '8px'}}>
          {authenticated ? '‚úì Authenticated' : '‚ö† Not Authenticated'}
        </div>
      </div>
      <div className="accounts">
        <h3 style={{marginBottom: '16px'}}>üí∞ Accounts</h3>
        {data.accounts.map((a, i) => (
          <div key={i} className="account">
            <span>{a.currency}</span>
            <span style={{fontWeight: 'bold'}}>{fmt(a.balance, a.currency)}</span>
          </div>
        ))}
      </div>
      <div className="tx-list">
        <h3 style={{marginBottom: '16px'}}>üìã Transactions</h3>
        {data.txs.map(t => (
          <div key={t.id} className="tx">
            <div style={{fontSize: '24px'}}>{t.icon}</div>
            <div style={{flex: 1}}>
              <div style={{fontWeight: 600}}>{t.name}</div>
              <div style={{fontSize: '13px', opacity: 0.6}}>{t.currency}</div>
            </div>
            <div className={t.type} style={{fontWeight: 600}}>
              {t.amount > 0 ? '+' : ''}{fmt(t.amount, t.currency)}
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
